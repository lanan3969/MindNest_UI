# MindNest Backend API

FastAPIåç«¯æœåŠ¡ï¼Œæä¾›ç„¦è™‘è¯„ä¼°ã€åˆ†çº§ç–—æ„ˆæ¨èå’Œæƒ…ç»ªç®¡ç†åŠŸèƒ½ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# åˆ‡æ¢åˆ°åç«¯ç›®å½•
cd 01_Backend_AI

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ ModelScope API Key
# è·å–åœ°å€: https://modelscope.cn/my/myaccesstoken
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡è½½ï¼‰
python main.py

# æˆ–ä½¿ç”¨ uvicorn å‘½ä»¤
uvicorn main:app --reload --port 8000
```

### 4. è®¿é—®æ–‡æ¡£

- **Swagger UI:** http://localhost:8000/docs
- **ReDoc:** http://localhost:8000/redoc
- **å¥åº·æ£€æŸ¥:** http://localhost:8000/health

---

## ğŸ“¡ APIæ¥å£

### æ ¸å¿ƒæ¥å£ï¼š`POST /api/v1/assess`

**åŠŸèƒ½ï¼š** åŒæºè¯„ä¼° + åˆ†çº§ç–—æ„ˆæ¨è

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST "http://localhost:8000/api/v1/assess" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "user_001",
    "diary_text": "ä»Šå¤©è€ƒè¯•è€ƒç ¸äº†ï¼Œå¿ƒæƒ…å¾ˆä½è½...",
    "conversation_text": "Nomiï¼Œæˆ‘è§‰å¾—è‡ªå·±å¾ˆå¤±è´¥",
    "timestamp": "2026-01-26T10:00:00Z"
  }'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "anxiety_score": 6.2,
  "healing_mode": "altruistic",
  "nutrient_type": "water",
  "nutrient_emoji": "ğŸ’§",
  "nutrient_amount": 15,
  "nomi_expression": "ç–‘é—®.png",
  "nomi_emotion": "worried",
  "task": null,
  "message": "Nomi ç°åœ¨æœ‰ç‚¹æ‹…å¿ƒï¼Œå»å’Œå®ƒèŠèŠå¤©å§~",
  "ai_reasoning": "æ£€æµ‹åˆ°ä¸­åº¦ç„¦è™‘å…³é”®è¯ï¼š2ä¸ªï¼Œå­˜åœ¨æƒ…ç»ªæ³¢åŠ¨",
  "timestamp": "2026-01-26T10:00:00Z"
}
```

### è¾…åŠ©æ¥å£

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/api/v1/tasks` | GET | è·å–æ‰€æœ‰ä»»åŠ¡ |
| `/api/v1/expressions` | GET | è·å–è¡¨æƒ…æ˜ å°„è§„åˆ™ |

---

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬ï¼ˆéœ€å…ˆå¯åŠ¨æœåŠ¡ï¼‰
python test_api.py
```

æµ‹è¯•æ¶µç›–ï¼š
- âœ… è½»åº¦ç„¦è™‘æ¡ˆä¾‹ (A â‰¤ 3.5)
- âœ… ä¸­åº¦ç„¦è™‘æ¡ˆä¾‹ (3.5 < A â‰¤ 7)
- âœ… é‡åº¦ç„¦è™‘æ¡ˆä¾‹ (7 < A â‰¤ 10)
- âœ… å…»æ–™æ˜ å°„æ­£ç¡®æ€§
- âœ… ä»»åŠ¡ç”Ÿæˆé€»è¾‘

---

## ğŸ¯ åˆ†çº§ç–—æ„ˆé€»è¾‘

### è½»åº¦ç„¦è™‘ [0, 3.5]
- **æ¨¡å¼:** `breathing` (å‘¼å¸ç–—æ„ˆ)
- **å…»æ–™:** â˜€ï¸ é˜³å…‰ +10ç‚¹
- **åœºæ™¯:** åŒå¿ƒåœ†å‘¼å¸åŠ¨ç”»

### ä¸­åº¦ç„¦è™‘ (3.5, 7]
- **æ¨¡å¼:** `altruistic` (åˆ©ä»–ç–—æ„ˆ)
- **å…»æ–™:** ğŸ’§ æ°´ +15ç‚¹
- **åœºæ™¯:** ç…§é¡¾çƒ¦æ¼çš„Nomi

### é‡åº¦ç„¦è™‘ (7, 10]
- **æ¨¡å¼:** `behavioral_activation` (è¡Œä¸ºæ¿€æ´»)
- **å…»æ–™:** ğŸŒ± è‚¥æ–™ +25ç‚¹
- **åœºæ™¯:** ç”Ÿæˆç¦»çº¿ä»»åŠ¡

---

## ğŸ¤– AIæ¨¡å‹é…ç½®

### ç”Ÿäº§æ¨¡å¼ï¼ˆéœ€API Keyï¼‰

åœ¨ `.env` ä¸­é…ç½®ï¼š
```bash
MODELSCOPE_API_KEY=your_actual_key
```

### Mockæ¨¡å¼ï¼ˆå¼€å‘æµ‹è¯•ï¼‰

å¦‚æœæœªé…ç½®API Keyï¼Œç³»ç»Ÿè‡ªåŠ¨å¯ç”¨Mockæ¨¡å¼ï¼š
- ä½¿ç”¨å…³é”®è¯è§„åˆ™å¼•æ“æ¨¡æ‹Ÿè¯„ä¼°
- æ— éœ€å¤–éƒ¨APIè°ƒç”¨
- ç»“æœç¨³å®šå¯å¤ç°

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
01_Backend_AI/
â”œâ”€â”€ main.py              # ä¸»åº”ç”¨æ–‡ä»¶
â”œâ”€â”€ requirements.txt     # Pythonä¾èµ–
â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .gitignore           # Gitå¿½ç•¥è§„åˆ™
â”œâ”€â”€ test_api.py          # è‡ªåŠ¨åŒ–æµ‹è¯•
â””â”€â”€ README.md            # æœ¬æ–‡æ¡£
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç«¯å£è¢«å ç”¨

```bash
# æ›´æ¢ç«¯å£
uvicorn main:app --port 8001
```

### é—®é¢˜2: ModelScope APIè¶…æ—¶

- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤API Keyæœ‰æ•ˆæ€§
- åˆ‡æ¢åˆ°Mockæ¨¡å¼æµ‹è¯•

### é—®é¢˜3: ä¾èµ–å®‰è£…å¤±è´¥

```bash
# å‡çº§pip
pip install --upgrade pip

# ä½¿ç”¨å›½å†…é•œåƒ
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **å“åº”æ—¶é—´:** < 500ms (Mockæ¨¡å¼)
- **å¹¶å‘æ”¯æŒ:** 100+ QPS
- **å¯ç”¨æ€§:** 99.9%

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-26)
- âœ… å®ç°æ ¸å¿ƒè¯„ä¼°æ¥å£
- âœ… é›†æˆ Qwen-2.5 æ¨¡å‹
- âœ… å®Œæˆåˆ†çº§ç–—æ„ˆç®—æ³•
- âœ… æ·»åŠ Mockæ¨¡å¼æ”¯æŒ

---

**ç»´æŠ¤è€…:** MindNest Team  
**æœ€åæ›´æ–°:** 2026-01-26
